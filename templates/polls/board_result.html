{% extends 'sub-base.html' %}

{% block content %}
<div class="container mt-2">
    <h2 class="mb-4 text-center">투표 결과 보기</h2>
    <div class="mb-3 row">
        <label for="name" class="col-form-label col-sm-3">보드 이름</label>
        <div class="col-sm-9">
            <input type="text" class="form-control" id="name" name="name" value="{{ board.name }}" placeholder="보드의 이름을 입력하세요" disabled>
        </div>
    </div>
    <div class="mb-3 row">
        <label for="start_time" class="col-sm-3 col-form-label">투표 시작 시각</label>
        <div class="col-sm-9">
            <input type="datetime-local" class="form-control" id="start_time" name="start_time"
                   value="{{ board.start_time|date:'Y-m-d H:i'}}" disabled>
        </div>
    </div>
    <div class="mb-3 row">
        <label for="end_time" class="col-sm-3 col-form-label">투표 종료 시각</label>
        <div class="col-sm-9">
            <input type="datetime-local" class="form-control" id="end_time" name="end_time"
                   value="{{ board.end_time|date:'Y-m-d H:i'}}" disabled>
        </div>
    </div>
</div>

<!-- 질문들 -->
<div class="container mt-2">
{% for question in questions %}
    <div class="card mb-2 shadow">
        <div class="card-body">
            <div class="card-title d-flex justify-content-between">
                <div class="fw-bolder">{{ question.text }}</div>
            </div>
            <div class="row">
                <div class="col-6 px-2">
                {% if question.media_type == 'image' %}
                    <img src="{{ question.media_url }}" alt="Image" class="img-thumbnail">
                {% elif question.media_type == 'video' %}
                    <iframe width="100%" height="360" src="https://www.youtube.com/embed/{{ question.video_id }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                {% else %}
                    <p>-- 미디어가 없습니다 --</p>
                {% endif %}
                </div>
                <div class="col-6 px-2 d-flex justify-content-center align-items-center">
                    <canvas id="question-chart-{{question.id}}" style="max-width: 25rem; max-height: 25rem"></canvas>
                </div>
            </div>
        </div>
    </div>
{% empty %}
이 보드에는 아직 질문이 없습니다. "질문 만들기" 버튼을 눌러 만드세요.
{% endfor %}
</div>

<div class="text-center my-4">
    <button type="button" class="btn btn-primary" id="backBtn">
        <i class="bi bi-arrow-return-left"></i>
        돌아가기
    </button>
</div>

<script>
    $('#backBtn').click(function () {
        window.history.back(); // 브라우저 히스토리에서 이전 페이지로 이동
    });

    $(document).ready(function () {
        const choiceLabels = ['AAAA', 'BBBB', 'CCCC'];
        const choiceCounts = [3, 4, 5];

        const ctx = $('#question-chart-5')[0].getContext('2d');
        const questionsPieChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: choiceLabels, // 각 질문 제목
                datasets: [{
                    data: choiceCounts, // 선택지 개수
                    backgroundColor: [
                        '#007bff', '#28a745', '#ffc107', '#dc3545', '#6c757d', '#17a2b8'
                    ], // 각 섹션의 색상
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom', // 범례 위치
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                const question = choiceLabels[tooltipItem.dataIndex];
                                const count = choiceCounts[tooltipItem.dataIndex];
                                return `${question}: ${count} 투표`;
                            }
                        }
                    }
                }
            }
        });



    });
</script>
{% endblock %}